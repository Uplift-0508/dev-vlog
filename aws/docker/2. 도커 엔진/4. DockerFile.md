# DockerFile

## 이미지 생성 방법

개발한 애플리케이션을 컨테이너화하는 기본적인 방법입니다.
1  빈 이미지 (우분투, CentOS 등) 으로 컨테이너 생성
2  환경 설치하고 애플리케이션 소스코드를 복사한 뒤 잘 동작하는지 확인
3  컨테이너를 이미지로 커밋 (commit)

* 컨테이너로 이미지를 생성하는 방법
```
[도커이미지] -> [새로운컨테이너] -> [애플리케이션설치된 컨테이너] -> [새로운이미지]
      1 컨테이너 생성    2 애플리케이션 설치             3 컨테이너 커밋
```                                    

* Dockerfile 로 이미지를 생성하는 방법          
```    
[도커이미지] -> [새로운이미지]
     1 Dockerfile 빌드        
```                 

컨테이너에 설치해야할 패키지, 소스코드, 실행해야할 명령어와 쉘 스크립트 등을 하나의 파일에 기록해 두면, 도커가 이 파일을 읽어 컨테이너에서 작업을 수행한 뒤 이미지로 만듭니다. 이 파일 이름을 Dockerfile 이라고 합니다. 

Dockerfile 을 사용하면 직접 컨테이너를 생성하고 이미지로 커밋해야하는 번거로움을 덜고, 깃을 통해 애플리케이션 빌드&배포를 자동화할 수 있습니다.


## Dockerfile 작성

Dockerfile 에는 컨테이너에서 수행해야할 작업을 명시합니다.

Dockerfile 은 한 줄이 하나의 명령어이고, 명령어 뒤에 옵션을 추가하면 됩니다.
명령어를 일반적으로 대문자로 표기하지만, 대소문자 모두 사용가능합니다.

**FROM :** 필수값이며, 생성할 이미지의 베이스가 될 이미지.
**MAINTAINER :** 이미지를 생성한 개발자 정보. (도커 1.13.0 버전 이후 사용X)
**LABEL :** 이미지에 저장되는 '키:값' 의 형태로 저장되는 메타데이터.
**RUN :** 이미지를 만들기 위해 컨테이너 내부에서 명령어를 실행.
**ADD :** 파일을 이미지에 추가. 추가하는 파일을 Dockerfile 이 위치한 디렉터리인 컨텍스트(Context) 에서 가져옴. 
**WORKDIR :** 명령어를 실행할 디렉터리. bash shell 에서 cd 명령어와 동일한 기능. 
WORKDIR 를 여러번 사용할 경우 cd 명령어를 여러 번 사용한 것과 동일.
**EXPOSE :** Dockerfile 빌드로 생성된 이미지에서 노출할 포트 설정. 
**CMD :** CMD 는 컨테이너가 시작될 때마다 실행할 명령어(커맨드)를 설정하며, Dockerfile 에서 한 번만 사용.


## Dockerfile 빌드

### 이미지 생성
앞에서 작성한 Dockerfile 을 빌드하는 명령어 
```
#   docker build -t history-api.1.0.0 ./(Dockerfile 이 저장된 경로)
```

docker images 명령어의 필터에 라벨 적용

--filter 옵션을 통해 해당 라벨을 가지는 이미지.
```
docker images --filter "label=practice"
```

<!--stackedit_data:
eyJoaXN0b3J5IjpbOTkwOTIxNzUzLC0xOTI5NjczNzM2LDE5Mz
M2MTgxMywtMTQxNTc2MjAyNSw3NDM5Nzk5NDMsLTE4MDY1MjM1
NDYsNTY3ODM4ODEsLTQ2NDU0NDAxMCwxOTkzNTQxMzY4LDYyMT
Y5NTUwMiwtMzk0MzMyNSwxNzMyNzM5OTldfQ==
-->