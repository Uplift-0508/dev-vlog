# 운영 서버의 외부 환경 구성

## 도메인, DNS

운영서버라면 도메인이 필요합니다. 도메인 주소가 없다면 서버 IP 주소가 변경되는 경우 사이트 접속이 안될 수 있고, IP 주소는 인간친화적이지 않아서 사이트 접속할 때 이용하는 것이 불편하기 때문입니다.

### 도메인 주소 작동 원리
![enter image description here](https://www.experfy.com/blog/wp-content/uploads/2020/06/dns-query-process.png)

1. 웹 브라우저의 주소창에 thetomkim.com 을 입력하고 요청합니다.
2. 웹 브라우저에서 가까운 DNS 서버에 thetomkim.com 이라는 도메인의 실제 IP 를 알고 있는지 물어봅니다.
3. 해당 DNS 서버가 모르면, 그 다음 DNS 서버에게 물어봅니다.
4. thetomkim.com 의 실제 IP 주소를 알고 있는 DNS 서버를 만나면 해당 서버에서 IP 주소인 52.79.xx.xx 를 알려줍니다.
5. 웹브라우저에서 52.79.xx.xx 라는 IP 주소로 페이지 조회 요청합니다.

DNS (Domain Name System) 서버는 도메인과 그 도메인에 연결된 IP 주소들을 관리하는 서버입니다. 도메인을 등록하기 위해서, 도메인 네임 등록 대행자에게 사용 가능한 도메인을 구매해야 합니다. 도메인을 산 뒤에 해당 도메인에 IP 주소를 연결을 요청합니다. 도메인 네임 등록 대행자는 DNS 서버들에 도메인과 IP 주소를 등록합니다. 이 때, 중복 발급되지 않도록 보장합니다. 

AWS 에서도 Route53 서비스를 통해 도메인 등록 대행 서비스를 제공합니다. 즉 Route53 을 통해 도메인을 구매, 관리할 수 있습니다.

## SSL/TLS 인증서, HTTP 동작 방식

HTTPS (HTTP Secure) 는 HTTP 프로토콜의 보안이 강화된 버전입니다. HTTP 프로토콜에 SSL/TLS 암호화 과정을 추가한 것입니다. 
HTTPS 는 기밀성, 무결성, 인증 3 가지 목적을 달성하기 위해 사용합니다. 중간에 내용을 가로채가도 내용을 읽지 못하게 암호화하는 것이 기밀성이고, 내용을 변조해서 중간자 공격을 못하게 하는 것이 무결성입니다. 그리고 클라이언트가 통신하고 있는 서버의 신원을 확인할 수 있는 것이 인증입니다.

### HTTPS 동작 방식
![enter image description here](https://mk0gcgablogq2ifx558u.kinstacdn.com/wp-content/uploads/2011/11/HTTPS.png)

1. 서버 관리자가 인증서 발급 기관을 통해 서비스하는 도메인에 대한 인증서를 발급 받습니다.
2. 발급받은 인증서를 클라이언트와 통신하는 서버 인스턴스의 웹 서버에 설치합니다.
3. 이용자가 웹브라우저 등의 클라이언트에서 https:// 로 시작하는 주소로 접속을 시도 합니다.
4. 클라이언트는 사용자가 입력한 주소에 해당하는 서버에 SSL/TLS 로 암호화한 통신을 하고 싶다고 요청하면서 사용할 수 있는 SSL/TLS 버전 목록과 암호화 알고리즘을 전달합니다.
5. 서버는 클라이언트가 전달한 SSL/TLS 버전과 암호화 알고리즘 중 선호하는 것을 고르고 서버에 설치된 인증서를 함께 응답합니다. 서버에서 전달하는 이 인증서는 공개 암호화 키를 포함하고 있습니다.
6. 클라이언트는 서버의 인증서가 신뢰할 수 있는 곳으로부터 서명된 것인지 확인하고 대칭 암호화 키로 사용할 키를 생성해서 서버에서 받은 공개 암호화 키로 암호화해서 전달합니다.
7. 서버와 클라이언트는 이 대칭 암호화 키를 이용해서 암복호화가 잘 되는지 테스트 합니다.
8. 이 후, 서버와 클라이언트는 서로 데이터를 주고받을 때 대칭 암호화 키를 이용해 암호화해서 전달합니다.

브라우저에서 http 로 요청을 보내도 자동으로 프로토콜을 https 로 변경해서 주소가 https 로 변경할 수 있습니다. 서버에 설치된 nginx 같은 웹 서버에서 https 로 리다이렉트하도록 설정하면 됩니다.

AWS 에서는 Route53 을 통해서 관리하는 도메인에 대해서는 Certificate Manager 서비스를 통해 무료로 인증서를 발급해줍니다.

SSL/TLS 인증서는 HTTPS 통신을 위한 것이기 때문에 클라이언트와 직접 통신하는 서버에 설치돼 있어야 합니다. 다중 서버 아키텍처에서는 클라이언트와 직접 통신하는 것이 로드 밸런서 서버이기 때문에, 로드 밸런서 서버에 인증서를 설치해야 합니다. 웹 서버마다 인증서를 추가할 수 있는 설정을 제공합니다. 


<!--stackedit_data:
eyJoaXN0b3J5IjpbNDM3NDkxODM2LDk2NTY5MjIxNiw0Mzc0OT
E4MzZdfQ==
-->