
# 운영 서버 

**운영 서버** 는 개발이나 테스트 목적이 아닌 실제 사용자들을 대상으로 서비스하는 서버입니다. 운영 서버는 개발 서버와 다르게 **트래픽 대응**도 해야하고 **빠른 응답 속도**와 **높은 가용성**을 보장해야 합니다. 

# 운영 서버 관리 3 step

## 환경 구성
**환경 구성** 은 서비스할 코드를 구동시킬 수 있는 서버 인프라를 구축하는 것입니다.

## 코드 배포
**코드 배포** 는 구성한 환경에 최신 버전의 코드를 빠르고 안전하게 배포하는 것입니다.

## 모니터링
**모니터링** 은 안정적인 서비스 운영을 위해 서버와 코드에 어떤 이상이 없는지 바로 파악하고 대응할 수 있게 도와주는 것입니다.

# AWS

## 환경 구성

### 단일 서버 구성 
![enter image description here](https://jjamong.github.io/docs/infra/aws/ec2/architecture/01.png)

운영 서버의 가장 기본적인 구성입니다. 

### 애플리케이션/데이터베이스 서버 분리 
![enter image description here](https://jjamong.github.io/docs/infra/aws/ec2/architecture/02.png)
단일 서버 구성에서 데이터베이스를 별도의 서버로 분리한 구성입니다.

### 서버 단위의 로드 밸런서
![enter image description here](https://jaehyun8719.github.io/images/aws/elastic-load-balancing/elastic-load-balancing-1.png)

### 서버 내 앱 단위의 로드 밸런서
![enter image description here](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2018/05/04/Picture1-updated.jpg)

## EC2 를 이용한 서버 인스턴스 생성과 관리

### EC2
Elastic Compute Cloud 는 컴퓨터 사양을 선택할 수 있고, 사용 시간만큼 지불할 수 있는 **가상 서버** 입니다. 

#### AMI
EC2 인스턴스의 기반이 되는 이미지입니다.
내가 원하는 환경을 구성한 뒤 이미지로 만들어서 재사용할 수 있습니다.

#### 보안그룹
보안을 위해 IP 와 포트 번호를 이용해 정의해두는 **서버 접속 규칙** 입니다. 특정 IP 와 포트에 대해서만 서버에 접속을 허용하거나 반대로 특정 IP 만 금지할 수도 있습니다. 정의된 규칙들을 여러 서버에 적용할 수 있습니다.

#### 키 페어
서버에 접속하기 위한 열쇠입니다. 공개 키 암호화 기법으로 서버에는 공개키를 두고 사용자는 개인키를 들고 접속합니다. 개인키는 유출될 경우 허가받지 않은 사람도 서버에 접속할 수 있으니 안전하게 보관해야 합니다. 

# 웹 서버와 웹 애플리케이션 서버

서버 인스턴스에는 클라이언트의 요청을 받아 적절한 정적 파일을 응답하거나 애플리케이션 코드로 그 요청을 처리할 수 있게 도와주는 소프트웨어가 필요합니다. 서버 소프트웨어에는 **웹 서버** 와 **웹 애플리케이션 서버** 로 구분됩니다.

## 웹 서버
웹 서버는 클라이언트에서 HTTP 프로토콜로 요청을 받고 정적인 파일들을 응답으로 전달합니다. HTML, 이미지, CSS, JS 파일과 같은 정적인 파일 내용을 응답으로 제공할 수 있지만, 서버에서 애플리케이션 코드를 실행하여 결과를 줄 수는 없습니다. 
예) nginx, Apache, IIS..

## 웹 애플리케이션 서버 (WAS)
클라이언트의 요청에 대해 코드를 실행하고 동적인 응답을 제공합니다. 배포한 코드를 프로세스로 실행시키고, 프로세스에 클라이언트의 요청을 넘겨주기도 합니다. 서버 자원을 최적으로 사용하기 위해서 프로세스 수나 메모리를 조절하기도 합니다. 

소스코드를 실행하고 관리하는 소프트웨어이기 때문에 제품마다 지원하는 언어가 다릅니다. 그래서 애플리케이션 언어에 맞는 웹 애플리케이션 서버를 선택해야합니다.
예) Apache Tomcat, JBoss, Phusion Passenger..

## 웹 서버와 웹 애플리케이션 서버
웹 서버와 웹 애플리케이션 서버는 보통 함께 사용됩니다. 서버 한 대에서 여러 종류의 애플리케이션을 서비스하는 경우, 정적 파일 처리 외에도 여러 웹 애플리케이션 서버로 라우팅하는 기능도 제공합니다. 

한 서버 내에서 https://a-site.com 사이트와 https://b-site.com 사이트를 모두 서비스하고 있다면 웹 서버에서는 클라이언트에서 요청한 도메인 주소를 분석해서 적절한 애플리케이션 서버로 전달해줄 수 있습니다. 또 이미지나 CSS 같은 정적인 데이터는 굳이 애플리케이션을 실행해서 로드할 필요 없이 웹 서버에서 바로 응답으로 주면 됩니다. 

### 클라이언트 요청 이동 경로
1. 클라이언트에서 서버 인스턴스로 네트워크 패킷을 전송합니다. 이 때 네트워크와 ISP(인터넷 서비스 프로바이더) 등을 거칩니다.
2. 하드웨어인 서버 인스턴스에서는 해당 패킷을 읽어와서 인스턴스에 설치된 서버 OS 에 패킷을 넘깁니다.
3. 서버 OS 는 해당 패킷을 읽고 패킷에 적힌 포트를 리스닝하고 있는 웹 서버 프로세스에 요청 내용을 전달합니다.
4. 웹 서버에서는 해당 HTTP 요청을 분석해서 적절한 웹 애플리케이션 서버에 전달합니다.
5. 웹 애플리케이션 서버에서는 애플리케이션 코드를 실행하고 있는 애플리케이션 프로세스에 HTTP 요청 내용을 파라미터를 전달해서 실행한 뒤 그 코드의 결과값을 다시 웹 서버에 전달합니다.
6. 앞서 진행했던 단계의 반대 방향으로 클라이언트에게 응답이 전달됩니다.


nginx/apache, tomcat/phusionpassenger 설치
<!--stackedit_data:
eyJoaXN0b3J5IjpbNDMyMTg0NjMxLDgxMzI2MDYyNV19
-->