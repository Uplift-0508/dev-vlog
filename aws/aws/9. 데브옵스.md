# 데브옵스

데브옵스는 개발과 운영의 합성어로, 개발과 운영을 하나로 합쳐서 일하는 철학, 도구, 환경, 문화 등의 조합입니다. 
개발 부터 배포까지 모든 단계에 자동화와 모니터링을 도입해서 더 짧은 개발 주기, 더 많은 배포 빈도, 안정적인 소프트웨어를 배포하자는 목표를 가집니다. 
인원이 몇 없는 작은 회사라도 개발부터 배포까지 불필요하고 반복적인 과정이 존재해서 개발부터 배포까지 불필요한 시간이 소모될 경우, 데브옵스가 필요합니다. 

## 지속적 통합 (CI) 
Continuous Integration (지속적 통합)은 데브옵스의 소프트웨어 개발 방식 중 하나로, 개발자들이 코드를 메인 브랜치에 병합하는 시간을 앞당겨 버그를 빨리 찾을 수 있게 합니다.
지속적 통합이 도입될 경우 개발자들이 메인 브랜치에 코드를 커밋할 때마다 자동으로 전체 유닛 테스트를 실행하게 됩니다. 그리고 테스트가 실패한 경우에는 알림을 보내 해당 내용을 커밋한 개발자가 문제를 해결하게 합니다. 개발자들이 코드를 푸시하기 이전에 자신이 작성한 그리고 영향이 미쳤을 것이라고 예상하는 부분에 대해서는 유닛 테스트를 돌려볼 것이지만 전체 유닛 테스트는 돌리는 데 시간도 오래 걸리고, 비효율적입니다. 따라서 개발자는 우선 메인 브랜치에 커밋을 하고 예상하지 못한 영향으로 인해 테스트 케이스가 실패한 경우에만 문제를 처리하면 됩니다. 
매번 전체 테스트를 실행하게 되니 개발자들은 자신이 작성한 코드가 다른 곳에 영향을 미치는 것에 대한 걱정을 덜 하고 자주 커밋할 수 있게 됩니다. 다만 지속적 통합을 도입하기 위해서는 제품의 품질을 보장할 수 있다고 믿을 수있는 자동화 테스트가 잘 작성돼 있어야 합니다.

## 지속적 전달, 지속적 배포 (CD) 
지속적 전달 (Continuous Delivery) 와 지속적 배포 (Continuous Deployment) 도 데브옵스 소프트웨어 개발 방식입니다. 지속적 통합에 이어 영역을 더 확장해서 유닛 테스트까지 완료된 코드를 운영 서버에 배포하기 전 단계인 스테이지 서버에 배포하고, 해당 서버에서 UI 테스트, 연동 테스트 등 다양한 테스트를 자동으로 진행합니다. 모든 테스트를 통과했다면 운영 서버에 배포할 준비를 하는데, 이 때 수동으로 사람이 운영 서버 배포를 승인하면 지속적 전달이고 운영 서버까지 자동으로 배포하면 지속적 배포입니다. 

## AWS 에서 지원하는 데브옵스
AWS 에서는 데브옵스가 운영 서버 관리에 있어 중요하다고 인지하여, 데브옵스에 대한 여러 서비스를 제공합니다. 프로젝트 코드를 빌드하고 유닛 테스트를 실행할 수 있게 해주는 CodeBuild, 배포를 자동으로 수행하는 CodeDeploy, 소스코드 커밋 부터 배포까지 각자 상황에 맞는 파이프라인을 구성할 수 있게 해주는 CodePipeline 등이 있습니다.

CodeBuild 는 소스코드를 입력으로 받아 빌드, 컴파일하는 단계를 수행하고, 필요한 자동화 테스트를 함께 수행합니다.

CodePipeline 은 지속적 통합, 지속적 전달을 가능하게 하는 서비스 입니다. 소스코드 불러오기, 빌드, 배포, 승인 등 다양한 작업을 조합해서 필요에 맞는 파이프라인을 구성할 수 있게 해줍니다. AWS 서비스 외 깃허브, 젠킨스 등 외부 서비스와의 연동도 지원합니다. 예를 들어, 소스코드가 깃허브에 커밋되면 코드를 일겅와 CodeBuild 에서 유닛 테스트를 실행한 뒤 문제가 없다면 CodeDeploy 를 이용해 배포를 자동으로 진행합니다.

CodePipeline 에는 단계가 있고, 단계별로 어떤 작업들을 할지 지정할 수 있습니다. 즉 각 단계는 1개 이상 작업으로 이뤄집니다. 작업은 직렬로 실행될 수도 있고, 병렬로 동시에 실행될 수도 있습니다. 직렬로 작업이 있을 때 앞의 작업이 성공적으로 끝나야만 다음 작업으로 넘어갈 수 있습니다.

각 작업이 끝날 떄마다 뒤 작업에 데이터를 넘겨주기 위한 아티팩트 (artifact) 개념이 있습니다. 예를 들어 소스코드를 VCS 저장소에서 읽어오는 소스 작업이 끝나면 소스코드를 아티팩트로 삼아 빌드 단계로 넘겨줍니다. 빌드 단계에서 해당 소스코드를 빌드한 다음, 빌드된 결과물을 아티팩트로 삼아 다음 배포 단계로 넘겨줄 수 있습니다. 

### CodePipeline 작업 종류, 설명

승인
: 파이프라인의 다음 단계로 넘어가기 위해 사용자의 승인을 기다립니다. 사용자가 승인하면 파이프라인의 다음 단계로 넘어가고, 거절한다면 파이프라인은 끝나게 됩니다.

소스
: 소스코드를 가져옵니다. 모든 파이프라인은 소스 작업으로 시작해야 하는데, AWS S3, AWS CodeCommit, 깃허브 등과 연동할 수 있습니다.

빌드
: 코드를 빌드합니다. AWS CodeBuild, 젠킨스 등의 서비스와 연동할 수 있습니다.

테스트
: 미리 정의된 유닛 테스트 등의 자동화 테스트 코드로 테스트를 진행합니다. AWS CodeBuild, 젠킨스, 고스트 인스펙터 등의 서비스와 연동할 수 있습니다. 

배포
: 코드를 서버에 배포합니다. AWS CodeDeploy, AWS Elastic Beanstalk, ECS, CloudFormation 등의 서비스와 연동할 수 있습니다. 

호출
: AWS Lambda 를 호출해서 임의의 코드를 실행할 수 있습니다. 코드를 실행할 수 있기 때문에 이 작업에서 사실상 필요한 모든 작업을 진행할 수 있습니다. 외부 서비스에 노티, 깃허브 API 를 호출해서 버전을 기록하는 등의 작업을 할 수 있습니다. 

기본적인 CodePipeline 구성 흐름
코드가 메인 브랜치에 커밋되면 코드를 가져와 빌드, 테스트를 진행합니다. 문제가 없으면 사용자의 승인을 받아 운영 서버에 배포합니다. 중간마다 사용자에게 상황 업데이트를 보내주기 위해 Lambda 함수를 호출해서 이메일, 슬랙 같은 메신저로 알림을 보냅니다. 운영 서버에 배포가 완료된 후 현재의 버전을 버전 관리 시스템에 기록합니다. 

테스트를 직렬로 구성하면 전체 실행 시간이 너무 길어져서 단위를 나눠서 병렬로 실행할 수 있습니다. 테스트 결과는 Lambda 호출을 이용해 알림을 보낼 수 있습니다. 

데브옵스 목표는 서비스를 더 빠르게 고객에게 전달하는 것이기 때문에
배포, 알림, 버전 기록 등 사람이 하지 않아도 되는 단순 반복적인 작업은 최대한 CodePipeline 에 추가해서 불필요한 시간을 줄이는 것이 좋습니다. 

조금 더 발전된 파이프라인을 만들기 위해 배포가 이뤄질 때마다 알림을 받아볼 수 있게 알림 작업을 추가할 수도 있습니다. 알림 작업은 AWS의 서버리스 컴퓨팅 서비스인 Lambda 와 AWS 의 알림 서비스인 SNS (Simple Notification Service) 를 이용해 수행할 수 있습니다. 
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTU4OTA5MTI5OSwxMTIwMjQ3MjY3LC0yMT
E3Mzc3Mjc5LC0xNDA5NTk4MDcwLDEyMzA5MDI2MSwtOTQwNTcw
MDA2LC0xNjQwNjExMDc2LC0yMDg4NzQ2NjEyXX0=
-->